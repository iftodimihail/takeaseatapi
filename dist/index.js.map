{"version":3,"sources":["../src/index.js"],"names":["require","config","app","use","exposedHeaders","corsHeaders","bodyParser","json","limit","bodyLimit","urlencoded","extended","passport","initialize","dbClient","MongoClient","process","env","MONGO_URI","useNewUrlParser","connect","err","db","MONGO_DB","console","error","exit","swaggerOptions","swaggerDefinition","apis","swaggerSpec","get","req","res","setHeader","send","swaggerUi","serve","setup","next","notFound","validate","ValidationError","errors","internalError","listen","PORT","log"],"mappings":";;AAEA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAfAA,QAAQ,QAAR,EAAkBC,MAAlB;;AAiBA,IAAMC,MAAM,wBAAZ;;AAEAA,IAAIC,GAAJ,CAAQ,oBAAK;AACXC,kBAAgBH,iBAAOI;AADZ,CAAL,CAAR;;AAIAH,IAAIC,GAAJ,CAAQG,qBAAWC,IAAX,CAAgB;AACtBC,SAAOP,iBAAOQ;AADQ,CAAhB,CAAR;;AAIAP,IAAIC,GAAJ,CAAQG,qBAAWI,UAAX,CAAsB;AAC5BC,YAAU;AADkB,CAAtB,CAAR;;AAIAT,IAAIC,GAAJ,CAAQS,mBAASC,UAAT,EAAR;;AAEA;;;AAGA,IAAMC,WAAW,IAAIC,oBAAJ,CAAgBC,QAAQC,GAAR,CAAYC,SAA5B,EAAuC,EAACC,iBAAiB,IAAlB,EAAvC,CAAjB;AACAL,SAASM,OAAT;AAAA,qEAAiB,iBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEf;;;AAGMC,cALS,GAKJR,SAASQ,EAAT,CAAYN,QAAQC,GAAR,CAAYM,QAAxB,CALI;;;AAOf,gBAAIF,GAAJ,EAAS;AACPG,sBAAQC,KAAR,CAAcJ,GAAd;AACAL,sBAAQU,IAAR,CAAa,CAAb;AACD;;AAED;;;AAGMC,0BAfS,GAeQ;AACrBC,iCAAmB3B,iBAAO2B,iBADL;AAErBC,oBAAM,CAAC,wBAAD;AAFe,aAfR;AAmBTC,uBAnBS,GAmBK,4BAAaH,cAAb,CAnBL;;AAoBfzB,gBAAI6B,GAAJ,CAAQ,eAAR,EAAyB,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC3CA,kBAAIC,SAAJ,CAAc,cAAd,EAA8B,kBAA9B;AACAD,kBAAIE,IAAJ,CAASL,WAAT;AACD,aAHD;AAIA5B,gBAAIC,GAAJ,CAAQ,WAAR,EAAqBiC,2BAAUC,KAA/B,EAAsCD,2BAAUE,KAAV,CAAgBR,WAAhB,CAAtC;;AAEA;;;AAGA,oCAAeR,EAAf,EAAmBV,kBAAnB;;AAEA;;;AAGAV,gBAAIC,GAAJ,CAAQ,MAAR,EAAgB,sBAAOmB,EAAP,CAAhB;;AAEA;;;AAGApB,gBAAIC,GAAJ,CAAQ,UAAC6B,GAAD,EAAMC,GAAN,EAAWM,IAAX,EAAoB;AAC1B,sCAASN,GAAT,EAAcO,QAAd,CAAuB,WAAvB;AACD,aAFD;;AAIA;;;AAGAtC,gBAAIC,GAAJ,CAAQ,UAAUkB,GAAV,EAAeW,GAAf,EAAoBC,GAApB,EAAyBM,IAAzB,EAA+B;AACrC,kBAAIlB,eAAeoB,4BAASC,eAA5B,EAA6C;AAC3C,uBAAO,wBAAST,GAAT,EAAcR,KAAd,CAAoB,oCAAuBJ,IAAIsB,MAA3B,CAApB,CAAP;AACD;AACD,sCAASV,GAAT,EAAcW,aAAd,CAA4B,uBAA5B;AACD,aALD;;AAOA;;;AAGA1C,gBAAI2C,MAAJ,CAAW7B,QAAQC,GAAR,CAAY6B,IAAvB,EAA6B,YAAM;AACjCtB,sBAAQuB,GAAR,sBAAgC/B,QAAQC,GAAR,CAAY6B,IAA5C;AACD,aAFD;;AAxDe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjB;;AAAA;AAAA;AAAA;AAAA","file":"index.js","sourcesContent":["require('dotenv').config();\n\nimport 'babel-polyfill';\nimport express from 'express';\nimport cors from 'cors';\nimport bodyParser from 'body-parser';\nimport {MongoClient} from 'mongodb';\nimport config from './config';\nimport response from './concerns/response';\nimport routes from './routes';\nimport validate from 'express-validation';\nimport {formatValidationErrors} from './concerns/errors';\nimport passport from 'passport';\nimport passportConfig from './passport';\nimport swaggerJSDoc from 'swagger-jsdoc';\nimport swaggerUi from 'swagger-ui-express';\n\nconst app = express();\n\napp.use(cors({\n  exposedHeaders: config.corsHeaders\n}));\n\napp.use(bodyParser.json({\n  limit: config.bodyLimit\n}));\n\napp.use(bodyParser.urlencoded({\n  extended: false\n}));\n\napp.use(passport.initialize());\n\n/**\n * If a connection to the MongoDB is successfull, the API will continue loading\n */\nconst dbClient = new MongoClient(process.env.MONGO_URI, {useNewUrlParser: true});\ndbClient.connect(async (err) => {\n\n  /**\n   * Initializes the database\n   */\n  const db = dbClient.db(process.env.MONGO_DB);\n\n  if (err) {\n    console.error(err);\n    process.exit(0);\n  }\n\n  /**\n   * Configure & initialize swagger documentation\n   */\n  const swaggerOptions = {\n    swaggerDefinition: config.swaggerDefinition,\n    apis: ['./src/controllers/*.js'],\n  };\n  const swaggerSpec = swaggerJSDoc(swaggerOptions);\n  app.get('/swagger.json', function (req, res) {\n    res.setHeader('Content-Type', 'application/json');\n    res.send(swaggerSpec);\n  });\n  app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerSpec));\n\n  /**\n   * Configure the passport logic\n   */\n  passportConfig(db, passport);\n\n  /**\n   * API router\n   */\n  app.use('/api', routes(db));\n\n  /**\n   * If any request url does not start with /api, the response will be 404\n   */\n  app.use((req, res, next) => {\n    response(res).notFound('Not found');\n  });\n\n  /**\n   * All the errors will be caught here\n   */\n  app.use(function (err, req, res, next) {\n    if (err instanceof validate.ValidationError) {\n      return response(res).error(formatValidationErrors(err.errors));\n    }\n    response(res).internalError('Internal server error');\n  });\n\n  /**\n   * Starts server on the specified port\n   */\n  app.listen(process.env.PORT, () => {\n    console.log(`Started on port ${ process.env.PORT }`);\n  });\n});\n"]}